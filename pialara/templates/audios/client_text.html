{% extends 'layout.html' %}

{% block content %}
<header class="header">
    <h1 class="text-center">Grabar mi audio</h1>
    <br />
</header>

<section class="syllabus m-auto">
    <header class="syllabus__header">
        <h2>Grabar mi audio</h2>
    </header>

    <section class="syllabus__text" id="syllabus-collapse">
        <p class="hide-syllabus-text" id="syllabus-tag">{{ current_user.email }}</p>
        <p class="hide-syllabus-text" id="syllabus-type">frase</p>
        <textarea id="syllabus-text" placeholder="Escribe aqu铆 tu frase"></textarea>
    </section>
</section>

<section class="audio">
    <!--botones audio-->

    <!--fin botones audio-->
    <canvas class="visualizer rounded" height="60px"></canvas>
    <audio src="" id="recorded-audio"></audio>

    <button class="record-button" id="record-button">
        <svg width="29" height="28" viewBox="0 0 29 28">
            <defs>
                <path id="mic-path13"
                    d="M9.333 18.667A4.68 4.68 0 0 0 14 14V4.667A4.68 4.68 0 0 0 9.333 0a4.68 4.68 0 0 0-4.666 4.667V14a4.68 4.68 0 0 0 4.666 4.667zM7 4.667a2.34 2.34 0 0 1 2.333-2.334 2.34 2.34 0 0 1 2.334 2.334V14a2.34 2.34 0 0 1-2.334 2.333A2.34 2.34 0 0 1 7 14V4.667zm11.667 7V14c0 4.783-3.617 8.633-8.167 9.217v2.45H14c.7 0 1.167.466 1.167 1.166S14.7 28 14 28H4.667c-.7 0-1.167-.467-1.167-1.167s.467-1.166 1.167-1.166h3.5v-2.45C3.617 22.633 0 18.667 0 14v-2.333c0-.7.467-1.167 1.167-1.167s1.166.467 1.166 1.167V14c0 3.85 3.15 7 7 7s7-3.15 7-7v-2.333c0-.7.467-1.167 1.167-1.167s1.167.467 1.167 1.167z">
                </path>
            </defs>
            <g fill="none" fill-rule="evenodd" transform="translate(5)">
                <mask id="mic-mask13" fill="#fff">
                    <use xlink:href="#mic-path13"></use>
                </mask>
                <use xlink:href="#mic-path13"></use>
                <g fill="#FF4F5E" mask="url(#mic-mask13)">
                    <path d="M-5 0h28v28H-5z"></path>
                </g>
            </g>
        </svg>
    </button>
</section>

<section class="bottom">
    <button class="button send-button" id="send-button">
        <div hidden id="spinner" class="spinner-border spinner-border-sm" role="status">
            <span class="sr-only"></span>
        </div>
        Enviar
    </button>
</section>

<!-- Modales -->
<!-- Template para el modal de valoraci贸n (Oculto) -->
<div id="rating-template" style="display: none;">
    <div class="swal-content__rating">
        <span class="rating-label">驴Qu茅 tan f谩cil te result贸 pronunciar esta frase?</span>
        <div class="star-rating">
            <span class="rating-sub-label">Muy dif铆cil</span>
            <i class="bi bi-star-fill" data-value="1"></i>
            <i class="bi bi-star-fill" data-value="2"></i>
            <i class="bi bi-star-fill" data-value="3"></i>
            <i class="bi bi-star-fill" data-value="4"></i>
            <i class="bi bi-star-fill" data-value="5"></i>
            <span class="rating-sub-label">Muy f谩cil</span>
        </div>
        <p id="rating-feedback" style="display: none; color: green; margin-top: 10px; font-weight: bold;">隆Valoraci贸n
            guardada!</p>
    </div>
</div>
<!-- Modal Warning Mic - Custom -->
<div id="mic-warning-modal" class="mic-modal-overlay">
    <div class="mic-modal-content">
        <div class="mic-modal-icon">
            <svg viewBox="0 0 24 24" style="width: 60px; height: 60px; fill: #666;">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
             <svg class="mic-warning-badge" viewBox="0 0 24 24">
                <path fill="#ffbc42" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
             </svg>
        </div>
        <h3>No detectamos tu micr贸fono</h3>
        <p>Revisa que est茅 conectado y que el navegador tenga permiso para usarlo.</p>
        <button class="mic-modal-btn" onclick="document.getElementById('mic-warning-modal').style.display='none'">Continuar</button>
    </div>
</div>
<!-- Modal Consejos Audio - Custom -->
<div class="modal fade" id="modalConsejosAudio" tabindex="-1" aria-labelledby="modalConsejosAudioLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header align-items-center">
        <h5 class="modal-title d-flex align-items-center gap-2 fw-bold text-primary" id="modalConsejosAudioLabel">
          <svg viewBox="0 0 24 24" style="width: 32px; height: 32px; fill: currentColor;">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
          Consejos para grabar tu audio
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body small px-4 px-md-5">
        <p>Para ayudarnos a entrenar la inteligencia artificial, sigue estos consejos:</p>

        <ul>
          <li>Permanece en un lugar <strong>silencioso</strong> y evita ruidos de fondo.</li>
          <li>Mant茅n la <strong>calma</strong> y habla con naturalidad.</li>
          <li>Habla a un volumen c贸modo y claro.</li>
          <li>Revisa tu grabaci贸n y <strong>vuelve a grabarla</strong> si es necesario.</li>
          <li>No tengas prisa, t贸mate tu tiempo.</li>
        </ul>
      </div>

      <div class="modal-footer d-flex justify-content-between align-items-center px-4 px-md-5">
        <p class="mb-0 small text-start">隆Gracias por tu colaboraci贸n! </p>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendido</button>
      </div>

    </div>
  </div>
</div>
<!-- Bot贸n para abrir el modal de consejos de audio -->
  <button
    type="button"
    class="btn btn-outline-primary rounded-circle position-fixed top-0 end-0 m-3"
    style="width: 40px; height: 40px; z-index: 1055;"
    data-bs-toggle="modal"
    data-bs-target="#modalConsejosAudio"
    aria-label="Informaci贸n para grabar audio"
  >
    <strong>i</strong>
  </button>

<!-- fin Modales -->

<script src="https://unpkg.com/sweetalert@2.1.2/dist/sweetalert.min.js"></script>
<script src="{{ url_for('static', filename='js/speech-synthesis.js') }}"></script>
<script src="{{ url_for('static', filename='js/speech-recording.js') }}"></script>
{% endblock %}